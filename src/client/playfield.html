<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hello From The Client Side</title>
	<style>
		html, body { height: 100%; width: 100%;font-family: sans-serif; }
		#playfield {
			border: 3px solid #AAA;
			display: block;
			height: 1000px;
			width: 1000px;
		}
	</style>


</head>
<body>
	<div id="app">	
		<div id="log"></div>
		<button onclick="reset()">Reset</button>

		<canvas width="1000" height="1000" id="playfield"></canvas>
	</div>	
	<script type="text/javascript">
		var socket = new WebSocket("ws://10.4.1.28:4002"),
			player1 = [0,0],
			player1_v = [0,0];

		socket.onmessage = function(data){
			data = JSON.parse(data.data);
			var xbase = data.left.x;
			var xmax = data.right.x;
			var ybase = data.top.y;
			var ymax = data.bottom.y;

			var xdiff = xmax - xbase;

			var xcurr = (data.absolute.x - xbase) / xdiff * 1000;
			var ydiff = ymax - ybase;

			var ycurr = (data.absolute.y - ybase) / ydiff * 1000;
			document.getElementById("log").innerHTML = JSON.stringify(data) + xcurr + ',' + ycurr;
			player1_v[0] = xcurr;
			player1_v[1] = ycurr;
		};

		window.requestAnimationFrame(loop);
		function loop(){
			player1[0] += parseFloat(player1_v[0]).toFixed(1) * .5;
			player1[1] += parseFloat(player1_v[1]).toFixed(1) * .5;
			if (player1[0] <= 0) player1[0] = 0;
			if (player1[0] >= 990) player1[0] = 990;
			if (player1[1] >= 990) player1[1] = 990;
			if (player1[1] <= 0) player1[1] = 0;

			var canvas = document.getElementById("playfield"), 
				ctx = canvas.getContext("2d");

			ctx.clearRect(0,0,1000,1000);
			ctx.fillStyle = "red"; 
			ctx.fillRect(player1[0], player1[1], 10, 10);
			//ctx.translate(100,100);
			
		  	window.requestAnimationFrame(loop);
		}

		function reset(){
			var canvas = document.getElementById("playfield"), 
				ctx = canvas.getContext("2d");

			ctx.clearRect(0,0,1000,1000);
		}
	</script>
</body>
</html>